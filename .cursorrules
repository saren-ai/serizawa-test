# Serizawa Test — Cursor Project Rules

## Read first
Before writing any code, read all four documents in /docs/:
- serizawa-test-prd-v03.md       (full product spec)
- serizawa-prompt-template-v1.md (AI scoring engine)
- style-guide.md                 (design system)
- ux-flow.md                     (navigation + view specs)

## Stack
Next.js 14 (App Router), TypeScript, Tailwind CSS,
Supabase (Postgres + Auth + Storage), Anthropic Claude API
(claude-sonnet-4-20250514), Upstash Redis, Vercel

## Code conventions
- All scores: DECIMAL(4,2) — never integers
- Server-side score recomputation mandatory — never trust model math
- Q5 is a flag only — never in FinalScore calculation
- Character keys via normalizeCharacterKey() — see PRD §14
- All trope IDs reference taxonomy in PRD §8.4
- Prompt template version logged on every analysis record

## Architecture rules
- Scoring logic lives in /lib/scoring.ts only
- Prompt template lives in Supabase prompt_templates table
- Community scores never overwrite AI FinalScore
- Rate limiting: 3 analyses/min anonymous, 10 logged-in

## Navigation rules
- No vertical nav columns. Ever.
- Floating pill bar only — four destinations maximum
- See ux-flow.md §2 for full spec

## Design rules
- Dark mode native — no light mode in v1
- Rounded everything — minimum --radius-sm (8px)
- Pill buttons, circle icon buttons, no sharp corners
- Bilingual type moments — see style-guide.md §3.3
- Framer Motion for all animations — see style-guide.md §10