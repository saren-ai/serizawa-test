# Serizawa Test â€” Cursor Project Rules

## Project context
This is the Serizawa Test web application. Full PRD is in
serizawa-test-prd-v03.md. Prompt template is in
serizawa-prompt-template-v1.md. Read both before generating
any code.

## Stack
- Next.js 14 (App Router)
- TypeScript
- Tailwind CSS + Headless UI
- Supabase (Postgres + Auth + Storage)
- Anthropic Claude API (claude-sonnet-4-20250514)
- Upstash Redis (analysis cache)
- Vercel deployment

## Code conventions
- All scores are DECIMAL(4,2) â€” never integers
- Server-side score recomputation is mandatory â€” never trust
  model arithmetic (see computeScores() in prompt template)
- Q5 is a flag only â€” never include it in FinalScore calculation
- Character keys use normalizeCharacterKey() â€” see PRD Â§14
- All trope IDs reference the taxonomy in PRD Â§8.4
- Prompt template version must be logged on every analysis

## Architecture rules
- Analysis scoring logic lives in /lib/scoring.ts only
- Prompt template lives in Supabase prompt_templates table,
  not hardcoded in API routes
- Community scores never overwrite AI FinalScore
- Rate limiting: 3 analyses/min anonymous, 10 logged-in

## Tone
The app voice is: academically rigorous, pop-culturally witty,
transparently non-institutional. See PRD Â§2 for full voice guide.
Register tags (ðŸš¨ ðŸ“š ðŸ˜‚) appear on trope detections throughout the UI.